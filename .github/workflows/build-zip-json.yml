# .github/workflows/build‑zip‑json.yml
name: Build ZIP → upload to VPS

on:
  workflow_dispatch:          # run manually from Actions tab
  schedule:
    - cron: "0 8 * * 1"       # every Monday 08:00 UTC

permissions:
  contents: read              # we’re only reading the repo

jobs:
  build‑and‑deploy:
    runs-on: ubuntu-latest

    steps:
      # 1 ▸ Check out the repository
      - uses: actions/checkout@v4

      # 2 ▸ Build the compressed JSON
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps & build
        run: |
          python -m pip install --upgrade pip
          pip install pandas openpyxl xlrd
          python scripts/build_zip_json.py     # writes us‑zips.json.gz

      # 3 ▸ Upload the file to your server via SCP
      - name: Upload us‑zips.json.gz to VPS
        uses: appleboy/scp-action@v0.1.4
        with:
          host:     ${{ secrets.SSH_HOST }}        # <── matches secret name
          username: ${{ secrets.SSH_USER }}        # <── matches secret name
          key:      ${{ secrets.SSH_PRIVATE_KEY }} # <── matches secret name
          port: 22
          source:  "us-zips.json.gz"
          target:  ${{ secrets.SERVER_PATH }}      # <── matches secret name
