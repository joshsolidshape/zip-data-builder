# .github/workflows/build-zip-json.yml
name: Build ZIP → upload to VPS

on:
  workflow_dispatch:          # run manually from Actions tab
  schedule:
    - cron:  "0 8 * * 1"      # every Monday 08:00 UTC

permissions:
  contents: read              # only needs read, we’re not committing back

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:

      # 1 ▸ Check out repository
      - uses: actions/checkout@v4

      # 2 ▸ Build the compressed JSON
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Python deps & build file
        run: |
          python -m pip install --upgrade pip
          pip install pandas openpyxl xlrd
          python scripts/build_zip_json.py

      # 3 ▸ Upload to the server with SCP over SSH
      - name: Upload us‑zips.json.gz to VPS
        uses: appleboy/scp-action@v0.1.4
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: 22
          source: "us-zips.json.gz"
          target: ${{ secrets.SERVER_PATH }}


